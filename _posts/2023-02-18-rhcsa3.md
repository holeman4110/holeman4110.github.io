---
layout: single
title: "RHCSA Day3(Swap Partition, LVM, LDAP, NFS, PODMAN)"
categories: os
tags: [2023/02/18, 운영체제, RHCSA, 레드햇]
toc: true
toc_sticky: true
author_profile: true
comments: true
share: true
related: true
published: true
hidden: false
sidebar: 
    nav: "docs"
---

## 1. 서론  

&nbsp;&nbsp;&nbsp;&nbsp; RHCSA Certificate 공부를 위해 다뤄볼 여러가지 유형들을 복습하기 좋게 정리해보려고 한다.

## 2. 본론  

### 1. Swap Partition

&nbsp;&nbsp;&nbsp;&nbsp; Swap Partition은 하드디스크의 일부를 RAM처럼 사용하는 영역을 뜻한다. Windows의 Virtual Memory랑 정확히 같지는 않지만 비슷하다. 크기는 RAM의 2배를 설정하도록 권고하고 있으며, RAM이 모두 찼을 때 잘 사용하지 않는 Page들을 옮겨두는 예비 공간이라고 할 수 있다. 하지만 하드디스에 위치하기 때문에 속도는 느리다.

#### 1. 예제1

```
Create a 2G swap partition which take effect automatically at boot-start, and it should not affect the original swap partition.
```

```
# swapon --show
# free -h //이 명령어로 Swap Partition있는지 다시한번 확인 가능
# df -h //Swap을 만들 여유공간이 있는지 체크
# fallocate -l 2G /swapfile //용량 할당 명령어
# ls -lh /swapfile //용량 제대로 할당됐는지 확인
# chmod 600 /swapfile //root만 접근가능하도록 변경
# ls -lh /swapfile //권한 제대로 변경됐는지 확인
# mkswap /swapfile
# swapon /swapfile
# swapon --show
# free -h //Swap 추가됐는지 확인
# cp /etc/fstab /etc/fstab.bak //잘못될 경우 대비하여 백업생성
# vim /etc/fstab
/swapfile none swap sw 0 0 //내용추가
# mount -a //바로 적용 또는 재부팅으로 적용가능
```

#### 2. 예제2

```
Create a 512M partition, make it as ext4 file system, mounted automatically under /mnt/data and which take effect automatically at boot-start.
```

```
# swapon --show
# df -h
# umount /swapfile //예제1에 만들어놓은 swapfile unmount
# fdisk /swapfile 
n //add a new partition
p //primary
1 //partition number
enter
+512M
w //write table 
# fdisk -l //잘만들어졌나 체크
# vim /etc/fstab
/swapfile none ext4 defaults 0 0
# mount -a
```

```
//optional
# parted //2TB가 넘는 파티션 만들때 사용. 그이하는 보통 fdisk
```

### 3. LVM

&nbsp;&nbsp;&nbsp;&nbsp; LVM(Logical Volumes Manager)는 기존 파티션으로 디스크를 관리하는 것에 비해 크기를 유연하게 사용 가능하다.

#### 1. 예제1

```
Change the logical volume capacity named vo from 190M to 300M. and the size of the floating range should set between 280 and 320. (This logical volume has been mounted in advance.)
```

```
# fdisk -l //하드디스크 추가 후 확인가능(나같은경우 dev/sdb, dev/sdc 이런식으로 추가됨)
# pvcreate /dev/sdb
# vgcreate vo /dev/sdb //vgremove 볼륨그룹 삭제, vgreduce 축소
# vgdisplay //volume group 보는법
# lvcreate -L 190M -n v0 vo //volume group vo에 v0의 이름을 가진 190M의 logical volume 생성
# lvscan  //확인
# blkid //UUID 및 타입 확인
# vim /etc/fstab로 부팅시에도 적용되게 변경 
```

```
//optional
# lvreduce //lv volume 줄일때
// xfs file system은 xfs_growfs로 resize, ext file system은 resize2fs로 resize
```

#### 2. 예제2

```
Create a volume group, and set 8M as a extends. Divided a volume group containing 50 extends on volume group lv (lvshare), make it as ext4 file system, and mounted automatically under /mnt/data. And the size of the floating range should set between 380M and 400M.
```

```
# df -h
# pvcreate /dev/example11 //physical volume 생성
# vgcreate -s 8M vg1 /dev/example11 //volume group 생성
# lvcreate -n lvshare -l 50 vg1 
# mkfs.ext4 /dev/exmaple11/lvshare
# mkdir -p /mnt/data
# vim /etc/fstab
/dev/vg1/lvshare /mnt/data ext4 defaults 00
# mount-a
# df -h
```

### 4. ldap / nfs

&nbsp;&nbsp;&nbsp;&nbsp; NFS(Network File System)이란 네트워크 상에서 여러 서버간의 마운트를 통해 마치 하나의 파일 스토리지처럼 사용하는 기술이다. 파일을 쉽게 공유할 수 있는 만큼 보안에 취약하다는 단점이 있다. Autofs는 NFS을 사용할 때, 자동으로 마운트 해주거나 사용되지 않고 일정 시간이 지나면 자동으로 언마운트 해준다. 그리고 LDAP(Lightweight Directory Access Protocol)은 사용자가 조직, 구성원 등에 대한 데이터를 찾는 데 도움이 되는 프로토콜로, LDAP 디렉터리에 데이터를 저장하고 사용자가 디렉터리에 액세스할 수 있도록 인증하기 위해 주로 사용된다

#### 1. 예제1

```
Configure autofs to make sure after login successfully, it has the home directory autofs, which is shared as /home/ldapuser11 at the ip: xxx.xxx.xxx.xxx. and it also requires that, other ldap users can use the home directory normally.
```

```
# dnf search nfs
# dnf install -y nfs-utils autofs
# systemctl status nfs-server
# firewall-cmd --permanenet --add-service=nfs
# systemctl enable --now nfs-server
# vim /etc/auto.master
/misc /etc/auto.misc //default로 돼있는데 주석처리
/rhome /etc/auto.ldap //추가
# cp auto.misc auto.ldap
# vim auto.ldap 
ldapuser11 -rw,soft,intr xxx.xxx.xxx.xxx:/rhome/ldapuser40
* -rw,soft,intr xxx.xxx.xxx.xxx:/rhome/&
# systemctl enable --now autofs.service
# showmount -e xxx.xxx.xxx.xxx 
```

#### 2. 예제2

```
Configure autofs.
Configure the autofs automatically mount to the home directory of LDAP, as required: keduit.example.com use NFS to share the home to your system. This file system contains a pre configured home directory of user ldapuser11.
Home directory of ldapuser11 is:
keduit.exmaple.com /home/guests/ldapuser
Home directory of ldapuser11 should automatically mount to the ldapuser11 of the local /home/guests Home directory's write permissions must be available for users ldapuser1's password is password
```

```
# dnf install -y nfs-utils autofs 
# mkdir /home/rehome
# vim /etc/auto.master.d/test.autofs
# cp /home/guests /etc/auto.test
# vim /etc/auto.test
ldapuser11 -fstype=nfs,rw,sync keduit.example.com:/home/guests/ldapuser11
# vim /etc/exports
/home/guests/ldapuser11 xxx.xxx.xxx.xxx/24(rw,sync,no_root_squash)
# systemctl enable --now autofs
# systemctl status --now autofs
```

### 5. Podman(container)

```
# dnf -y install podman
# useradd podmanacc1
# passwd podmanacc1
위에 만든 계정으로 로그인
# podman search httpd
# podman run -d -p 8888:8080 --name web -v /home/user/www:/var/www:Z docker.io/library/httpd
# mkdir -p ~/.config/systemd/user
# cd ~/.config/systemd/user
# podman generate systemd --name web --files --new
# loginctl enable-linger
# systemctl --user daemon-reload
# systemctl --user enable --now web
# podman stop web
# reboot
# podman ps //자동으로 web 컨테이너가 실행됐는지 확인
```

## 3. 결론  

&nbsp;&nbsp;&nbsp;&nbsp; 나오는듯한 유형들은 대부분 정리한것 같으니 이제 남은 3일동안 반복숙달하는 일만 남았다.

---

```bash
클라우드 개발자를 넘어 데브옵스를 꿈꾸는 이제 막 공부를 시작한 초보 엔지니어입니다. 틀린 점이 있으면 친절하게 댓글 부탁드립니다. :)
```

---
